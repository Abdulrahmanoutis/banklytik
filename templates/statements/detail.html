{% extends "base.html" %}
{% block content %}
<h2>Transactions for {{ statement.title }}</h2>

<div class="mb-4">
  {% if not statement.processed %}
    <div class="alert alert-warning">
      <strong>Statement not processed yet.</strong> Choose a processing method:
    </div>
    <div class="btn-group" role="group">
      <a href="{% url 'statements:process' statement.pk %}" class="btn btn-outline-primary">
        ğŸ”„ Auto Process
      </a>
      <a href="{% url 'statements:start_selection' statement.pk %}" class="btn btn-primary">
        ğŸ¯ Manual Table Selection
      </a>
    </div>
  {% else %}
    <div class="btn-group" role="group">
      <a href="{% url 'statements:reprocess' statement.pk %}" class="btn btn-warning">
        ğŸ”„ Reprocess Statement
      </a>
      <a href="{% url 'statements:start_selection' statement.pk %}" class="btn btn-outline-primary">
        ğŸ¯ Manual Table Selection
      </a>
    </div>
  {% endif %}
</div>

<table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%;">
  <thead style="background-color: #f2f2f2;">
  <tr>
    <th>Parsed Date</th>
    <th>Value Date</th> <!-- ğŸ†• Add this -->
    <th>Raw Date</th>
    <th>Description</th>
    <th>Debit</th>
    <th>Credit</th>
    <th>Balance</th>
    <th>Channel</th>  
    <th>Reference</th> 
  </tr>
</thead>
 <tbody>
  {% for tx in transactions %}
  <tr>
    <td>
      {% if tx.date %}
        {{ tx.date|date:"M. d, Y" }}
      {% else %}
        <span style="color: red;" title="Date could not be parsed">âŒ Unparsed</span>
      {% endif %}
    </td>

    <!-- ğŸ†• Value Date column -->
    <td>
      {% if tx.value_date %}
        {{ tx.value_date|date:"M. d, Y" }}
      {% else %}
        <span style="color: gray;">â€”</span>
      {% endif %}
    </td>

    <td>
      {% if tx.raw_date %}
        <span style="color: #c0392b; font-family: monospace;">{{ tx.raw_date }}</span>
      {% else %}
        <span style="color: gray;">â€”</span>
      {% endif %}
    </td>

    <td>{{ tx.description }}</td>
    <td>{{ tx.debit|floatformat:2 }}</td>
    <td>{{ tx.credit|floatformat:2 }}</td>
    <td>{{ tx.balance|floatformat:2 }}</td>
    <td>{{ tx.channel|default:"EMPTY" }}</td>
    <td>{{ tx.transaction_reference|default:"â€”" }}</td>
  </tr>
  {% empty %}
  <tr><td colspan="9">No transactions found.</td></tr>
  {% endfor %}
</tbody>
</table>

<p><a href="{% url 'statements:list' %}">â† Back to list</a></p>
{% endblock %}
